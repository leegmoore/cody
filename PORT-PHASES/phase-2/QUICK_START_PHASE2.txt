===== COPY THIS INTO FRESH CLAUDE CODE SESSION FOR PHASE 2 =====

ROLE: You are a TypeScript developer porting the Codex Rust codebase to TypeScript.

PROJECT: Codex is an AI coding agent from OpenAI. We're porting from Rust to TypeScript to create a pure library (@openai/codex-core) that can be used without subprocess overhead.

STRATEGY: Test-Driven Development - port Rust tests first, then implement. Use stateless logs to track progress across sessions.

CURRENT PHASE: Phase 2 - Core Engine (7 modules, builds on Phase 1)

PHASE 1 STATUS: âœ… COMPLETE (283 tests, 100% pass rate)

NOTE: Workspace is /Users/leemoore/code/codex-port-02
(TypeScript port is in codex-ts/ subdirectory)

FIRST: Read these logs to understand status (all in codex-ts/):
- Read codex-ts/PORT_LOG_MASTER.md (overall status)
- Read codex-ts/PORT_LOG_PHASE1.md (Phase 1 summary)
- Read codex-ts/KNOWN_BUGS.md (bug tracking)
- Read codex-ts/DEV_STANDARDS.md (code standards)

THEN: Read full instructions:
- Read PORT-PHASES/phase-2/README.md (detailed plan)
- Read PORT-PHASES/phase-2/STATUS.md (current progress)
- Read PORT-PHASES/phase-2/CHECKLIST.md (task list)

SETUP (first session only):
- Run: cd codex-ts && npm install smol-toml
- Run: mkdir -p src/core

TASK: Port Phase 2 modules (core engine) using Test-Driven Development:
1. Read Rust source: codex-rs/core/src/[MODULE].rs
2. Read Rust tests: codex-rs/core/tests/[MODULE].rs (if exists)
3. Create codex-ts/src/core/[MODULE].test.ts - port tests to TypeScript/Vitest
4. Run tests (should fail): cd codex-ts && npm test
5. Create codex-ts/src/core/[MODULE].ts - implement until tests pass
6. Run: npm test (must pass!)
7. Type check: npx tsc --noEmit (must pass!)
8. Format: npm run format
9. Commit and push: git add -A && git commit -m "phase2: [MODULE]" && git push
10. Update PORT-PHASES/phase-2/CHECKLIST.md (check off completed items)
11. Update PORT-PHASES/phase-2/STATUS.md (add session log)
12. Update codex-ts/PORT_LOG_MASTER.md (update module status)
13. If bugs found: add to codex-ts/KNOWN_BUGS.md (don't fix unless critical)

START ORDER (4 modules only):
1. core/config (foundation)
2. core/config-loader (depends on config)
3. core/message-history (can be parallel with config-loader)
4. core/rollout (persistence)

DEFERRED (blocked by Phase 4/5 dependencies):
- core/codex (needs core/client from Phase 4)
- core/codex-conversation (needs core/codex)
- core/conversation-manager (needs AuthManager from Phase 5)

DEV STANDARDS (see codex-ts/DEV_STANDARDS.md):
- Use npm (not pnpm/bun)
- TypeScript strict mode (no 'any' types)
- Prettier handles formatting (single quotes, 100 char width)
- ESLint for code quality (TODO: configure)
- Every module needs comprehensive tests
- 100% test pass rate maintained
- Clear, descriptive variable names
- JSDoc comments for public APIs

BEFORE ENDING SESSION:
1. Update PORT-PHASES/phase-2/CHECKLIST.md (check off completed items)
2. Update PORT-PHASES/phase-2/STATUS.md (add session log with what you did)
3. Update PORT-PHASES/phase-2/DECISIONS.md (if any technical decisions made)
4. Update codex-ts/PORT_LOG_MASTER.md (update module progress)
5. Run: git add -A
6. Run: git commit -m "phase2: [description of what you completed]"
7. Run: git push
8. Report to user: modules completed, test count, what's next

GO! Start by reading STATUS.md to see current progress, then continue from where you left off.

============================================================
