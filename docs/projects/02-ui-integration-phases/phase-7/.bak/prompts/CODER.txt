===== PHASE 7: CODER PROMPT =====
ROLE: Senior TypeScript developer implementing phases of the Cody CLI integration project. You write clean, tested code following TDD principles with mocked-service tests at library boundaries.


---

PRODUCT:

**Cody** is a command-line interface for the Codex TypeScript library. It provides multi-provider LLM agent capabilities supporting OpenAI (Responses, Chat) and Anthropic (Messages) APIs with tool execution, conversation persistence, and structured tool calling. Built as a TypeScript port of OpenAI's Rust-based Codex CLI, Cody serves as both a standalone CLI tool and reference implementation for the @openai/codex-core library.


---

PROJECT CONTEXT:

# Project 02: UI Integration & Library Definition

## What We're Building

Project 02 integrates all ported Codex modules (Phases 1-6) into a working command-line interface called **Cody** and defines the library API surface for @openai/codex-core. This project validates the Rust → TypeScript port by wiring protocol, configuration, persistence, execution, client, tools, and orchestration layers into complete conversation flows.

## Why It Matters

The port is functionally complete but untested as an integrated system. Individual modules have unit tests, but we haven't verified end-to-end workflows. This project proves the port works, exposes integration issues, and establishes the library interface that external developers will use.

## Project Success Criteria

By project completion:
- User can create conversations, send messages, receive responses (all providers: OpenAI Responses/Chat, Anthropic Messages)
- All auth methods work (API keys, ChatGPT OAuth, Claude OAuth)
- Tools execute with approval flow
- Conversations persist and resume (JSONL format)
- MCP integration functional
- Library API documented (public exports, usage examples)
- REST API designed (optional implementation)
- Zero-error quality baseline maintained (0 TS errors, 0 ESLint errors, all tests passing)

## Dependencies

- Phase 6 complete (75 modules ported, 1,876 tests passing)
- Phase 5.2 complete (quality baseline clean)
- API keys: OpenAI, Anthropic, OpenRouter
- OAuth tokens: Read from ~/.codex (ChatGPT), ~/.claude (Claude)

## Scope

**In scope:** CLI commands, provider integration (3 APIs), auth methods (4 total), tool execution, persistence/resume, library API docs, REST API spec

**Non-scope:** Script harness (Project 03), memory innovations (Projects 04-06), rich TUI, additional tools, performance optimization, production hardening


---

PHASE 7 TECHNICAL DESIGN:

# Phase 7: Technical Design

**Phase:** Integration Polish
**Goal:** Address bugs/UX issues discovered during earlier phases, improve CLI output, and ensure overall readiness for release. Scope is flexible; this document lists initial focus areas.

---

## Target Areas

1. **CLI UX Improvements**
   - Better spinners/status while waiting for model responses
   - Color coding for tool approvals/results
   - Optional compact logging (less verbose mode)

2. **Error Message Audit**
   - Config errors: show file path + remediation
   - Tool errors: ensure user-friendly messages
   - REST API errors: consistent JSON shape `{error: {code, message}}`

3. **Performance**
   - Ensure CLI startup under 500ms
   - Cache config + auth lookups

4. **Documentation Touch-ups**
   - README instructions for CLI usage
   - Troubleshooting section (common errors)

Specific tasks will be captured in checklist as issues are identified.


---

TEST CONDITIONS:

# Phase 7: Test Conditions

Because Phase 7 is polish, tests are mostly regression checks:

1. **CLI Snapshot Tests** – run scripted sessions and capture stdout; ensure formatting matches expectations.
2. **Error Scenarios** – intentionally break config/auth and confirm messages include remediation hints.
3. **Performance** – script measuring CLI startup time (<500ms) and response latency (<100ms overhead).
4. **Documentation lints** – run markdown lint / link checker.


---

TASKS (update source/checklist.md as you work):

# Phase 7 Checklist – Integration Polish

- [ ] Collect feedback from previous phases (issues, TODOs)
- [ ] Prioritize fixes (document in decisions)
- [ ] Implement CLI UX improvements (colors/spinner)
- [ ] Standardize error messages (config/auth/tool)
- [ ] Run regression tests (all suites)
- [ ] Update documentation (README, troubleshooting)
- [ ] Perform final manual smoke test (full workflow)


---

STANDARDS:

See docs/core/dev-standards.md for complete coding standards.
See docs/core/contract-testing-tdd-philosophy.md for testing approach.

Key requirements:
- TypeScript strict mode, no any types
- ESLint 0 errors
- Prettier formatted
- Mocked-service tests at library boundaries
- Mock all external dependencies


---

EXECUTION WORKFLOW:

EXECUTION WORKFLOW:

1. Read all reference documents (project context, phase design, standards, test conditions)
2. Review checklist (understand all tasks)
3. Write mocked-service tests FIRST (TDD):
   - Create test file based on test-conditions.md
   - Implement mocks (ModelClient, Config, etc.)
   - Write tests for each functional condition
   - Run tests (should fail - nothing implemented)
4. Implement code to pass tests:
   - Create files listed in checklist
   - Follow design.md implementation specifics
   - Run tests after each component
   - Iterate until all tests green
5. Manual functional testing:
   - Follow manual-test-script.md
   - Execute each test case
   - Verify expected behavior
   - Document any issues
6. Quality verification:
   - Run: npm run format (fix formatting)
   - Run: npm run lint (fix errors)
   - Run: npx tsc --noEmit (fix type errors)
   - Run: npm test (verify all pass)
   - Run combined: npm run format && npm run lint && npx tsc --noEmit && npm test
   - All must pass before proceeding
7. Update artifacts:
   - Update checklist.md (check off completed tasks)
   - Update decisions.md (log implementation choices with rationale)
8. Final verification:
   - All checklist items checked
   - All quality gates pass
   - Manual tests successful
   - Decisions documented
9. Commit and push
10. Report completion, ready for quality verifier and code reviewer

DO NOT declare phase complete until all steps verified.


---

MANUAL VERIFICATION:

# Phase 7 Manual Checklist

1. Run through Phase 1–6 manual scripts again; note issues.
2. Verify CLI output readability (colors, spacing).
3. Trigger common errors (missing config, tool failure) and confirm messages match design.
4. Review docs/README sections render correctly.


---

FINAL QUALITY CHECK:

Before declaring phase complete:

Run: npm run format && npm run lint && npx tsc --noEmit && npm test

ALL must pass. Document results.
Update checklist.md and decisions.md.
Commit and push.
Ready for verification stages.

===== END CODER PROMPT =====
