ROLE: Senior TypeScript test engineer implementing Playwright API tests.

TASK: Implement complete Playwright test suite for Cody REST API based on functional test conditions.

WORKSPACE: /Users/leemoore/code/codex-port-02/cody-fastify

===

SPECIFICATIONS:

Read these documents first:
1. /Users/leemoore/code/codex-port-02/docs/projects/02-ui-integration-phases/apis/phase-6-spec/test-conditions.md (37 test conditions)
2. /Users/leemoore/code/codex-port-02/docs/projects/02-ui-integration-phases/apis/conversation-endpoints.md (API spec)

===

YOUR TASK:

Implement all 37 test conditions from test-conditions.md as Playwright tests.

DELIVERABLES:

1. Update tests/e2e/fixtures/api-client.ts with methods for all endpoints
2. Create tests/e2e/conversations.spec.ts (TC-1 through TC-5, ~25 tests)
3. Create tests/e2e/messages.spec.ts (TC-6, ~6 tests)
4. Create tests/e2e/turns.spec.ts (TC-7 and TC-8, ~13 tests)
5. Create tests/e2e/lifecycle.spec.ts (TC-L1 through TC-L7, 7 tests)
6. All tests pass against skeleton (expecting 501 responses)

===

API CLIENT PATTERN:

Extend existing ApiClient with methods for all endpoints.

Example methods to add:

```typescript
async createConversation(body: {
  modelProviderId: string;
  modelProviderApi: string;
  model: string;
  title?: string;
  summary?: string;
  tags?: string[];
  agentRole?: string;
}) {
  return this.request.post('/api/v1/conversations', { data: body });
}

async listConversations(query?: { cursor?: string; limit?: number }) {
  const params = query ? `?${new URLSearchParams(query as any)}` : '';
  return this.request.get(`/api/v1/conversations${params}`);
}

async getConversation(id: string) {
  return this.request.get(`/api/v1/conversations/${id}`);
}

async updateConversation(id: string, body: any) {
  return this.request.patch(`/api/v1/conversations/${id}`, { data: body });
}

async deleteConversation(id: string) {
  return this.request.delete(`/api/v1/conversations/${id}`);
}

async submitMessage(conversationId: string, body: {
  message: string;
  modelProviderId?: string;
  modelProviderApi?: string;
  model?: string;
}) {
  return this.request.post(`/api/v1/conversations/${conversationId}/messages`, { data: body });
}

async getTurnStatus(turnId: string, query?: { thinkingLevel?: string; toolLevel?: string }) {
  const params = query ? `?${new URLSearchParams(query as any)}` : '';
  return this.request.get(`/api/v1/turns/${turnId}${params}`);
}
```

===

TEST STRUCTURE:

Organize tests by feature area with clear describe blocks:

```typescript
import { test, expect } from './fixtures/api-client';

test.describe('Conversations - Create (TC-1)', () => {
  test('TC-1.1: Create with minimal config', async ({ api }) => {
    const response = await api.createConversation({
      modelProviderId: 'openai',
      modelProviderApi: 'responses',
      model: 'gpt-5-codex'
    });

    // Skeleton: expect 501
    expect(response.status()).toBe(501);

    // After implementation, change to:
    // expect(response.status()).toBe(201);
    // const data = await response.json();
    // expect(data.conversationId).toBeTruthy();
  });

  test('TC-1.2: Create with full metadata', async ({ api }) => {
    // ... implement per test-conditions.md
  });

  // ... all TC-1.x tests
});
```

===

PARALLEL VS SEQUENTIAL:

**Parallel tests (TC-1 through TC-8):**
- Run concurrently (no dependencies)
- Each test independent
- Fast execution

**Sequential tests (TC-L1 through TC-L7):**
- Run in order within each test
- Multi-step workflows
- State builds up within single test

===

TESTING AGAINST SKELETON:

All handlers currently throw NotImplementedError (return 501).

For now, tests should expect 501:

```typescript
test('TC-1.1: Create with minimal config', async ({ api }) => {
  const response = await api.createConversation({...});
  expect(response.status()).toBe(501);
});
```

Add comments for post-implementation assertions:

```typescript
// After implementation:
// expect(response.status()).toBe(201);
// const data = await response.json();
// expect(data.conversationId).toBeTruthy();
```

===

WORKFLOW:

1. Update ApiClient with all endpoint methods
2. Implement TC-1 tests (POST /conversations, 10 tests)
3. Implement TC-2 tests (GET /conversations, 5 tests)
4. Implement TC-3 tests (GET /conversations/:id, 2 tests)
5. Implement TC-4 tests (DELETE /conversations/:id, 3 tests)
6. Implement TC-5 tests (PATCH /conversations/:id, 9 tests)
7. Implement TC-6 tests (POST /conversations/:id/messages, 6 tests)
8. Implement TC-7 tests (GET /turns/:id, 5 tests)
9. Implement TC-8 tests (GET /turns/:id/stream-events, 8 tests)
10. Implement TC-L1 through TC-L7 (lifecycle tests, 7 tests)
11. Run: bun run test:e2e (all 37 tests should pass with 501 responses)
12. Commit: "test(api): add complete Playwright test suite (37 tests)"

===

QUALITY GATES:

- [ ] All 37 tests implemented
- [ ] All tests pass (expecting 501 from skeleton)
- [ ] No skipped tests
- [ ] Clean test output
- [ ] TypeScript compiles (no errors in test files)
- [ ] ESLint passes on test files

===

SOLUTION PERSISTENCE:

Complete all 37 tests in this session. Do not stop until entire test suite is implemented and passing against the skeleton.

===

START: Update ApiClient, then implement tests TC-1.1 through TC-L7 completely.