===== COPY THIS INTO FRESH CLAUDE CODE SESSION FOR PHASE 4.2 =====

ROLE: You are a TypeScript developer implementing Anthropic Messages API integration.

PROJECT: Codex TypeScript port - adding Anthropic as third provider alongside OpenAI.

STRATEGY: Test-Driven Development following expert design document.

CURRENT PHASE: Phase 4.2 - Anthropic Messages API Integration (11 stages)

PHASE 4.1 STATUS: âœ… COMPLETE (OpenAI Responses + Chat working with stub auth)

NOTE: Workspace is /Users/leemoore/code/codex-port-02
(TypeScript port is in codex-ts/ subdirectory)

CRITICAL: Read the design document FIRST
- Read MESSAGES_API_INTEGRATION_DESIGN_CODEX.md (complete architecture)
- This is your blueprint - follow it precisely

THEN: Read status and workplan
- Read PORT-PHASES/phase-4.2/WORKPLAN.md (11-stage breakdown)
- Read PORT-PHASES/phase-4.2/STATUS.md (current progress)
- Read PORT-PHASES/phase-4.2/CHECKLIST.md (detailed tasks)

APPROACH: Staged implementation (11 stages)
1. Foundation & Types (10 tests)
2. Tool Conversion (15 tests) - TEST FIRST
3. Request Builder (15 tests) - TEST FIRST
4. SSE Parser (15 tests) - TEST FIRST
5. Streaming Adapter (25 tests) - TEST FIRST, CRITICAL
6. Response Parser (20 tests) - TEST FIRST
7. Transport (12 tests)
8. Integration (10 tests)
9. Tool Round-Trip (10 tests)
10. Error Handling (15 tests)
11. Final Integration

WORKFLOW PER STAGE:
1. Read design doc section for this stage
2. Create test file FIRST
3. Write all tests for stage (from design test tables)
4. Run: npm test (should fail)
5. Implement until tests pass
6. Run: npm test (must pass!)
7. Type check: npx tsc --noEmit
8. Format: npm run format
9. Commit: git add -A && git commit -m "phase4.2: stage N - [description]" && git push
10. Update CHECKLIST.md (check off stage tasks)
11. Update STATUS.md (log stage completion)
12. Update PORT_LOG_MASTER.md
13. Move to next stage

TARGET: 167 tests total (merged design with parallel tools, error mappings, tokens, cancellation)

DEV STANDARDS:
- Use npm (not pnpm/bun)
- TypeScript strict mode (no 'any' types)
- Prettier formatting
- 100% test pass rate
- JSDoc comments

BEFORE ENDING SESSION:
1. Update PORT-PHASES/phase-4.2/CHECKLIST.md (check off completed items)
2. Update PORT-PHASES/phase-4.2/STATUS.md (session log with stages done)
3. Update codex-ts/PORT_LOG_MASTER.md
4. git add -A && git commit -m "phase4.2: [what you completed]" && git push
5. Report: stages done, tests passing, what's next

START with Stage 1 (Foundation & Types). Create the directory structure and type definitions.

IMPORTANT: Follow the design doc precisely. The test IDs (TC-01, RF-01, SE-01, etc.) map directly to test cases in the design.
