================================================================================
CODEX RUST MODULE DEPENDENCY GRAPH - Visual Dependencies
================================================================================

LEGEND:
  [X] = External dependency (codex-protocol, codex-common)
  P0/P1/P2/P3/P4/P5 = Phase number
  âœ“ = Clean (no forward dependencies)
  âš  = Warning (cross-phase dependency)
  ğŸš¨ = Critical (multiple cross-phase deps)

================================================================================
PHASE DEPENDENCY OVERVIEW
================================================================================

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  [codex_protocol]
                          â”‚  Type Definitions
                          â”‚  ~2,887 lines
                          â”‚  Required by ALL
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                  â”‚                  â”‚
           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
           â”‚   PHASE 0  â”‚    â”‚  [common]  â”‚    â”‚ [External]â”‚
           â”‚ Type Defs  â”‚    â”‚  Utilities â”‚    â”‚   Crates  â”‚
           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Foundation
                â”‚
           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚           PHASE 1: Standalone Utils              â”‚
           â”‚  âœ“ execpolicy (800 lines)     - Zero deps        â”‚
           â”‚  âœ“ file-search (600 lines)    - Zero deps        â”‚
           â”‚  âœ“ apply-patch (1600 lines)   - Zero deps        â”‚
           â”‚  âœ“ Common utilities (already ported)             â”‚
           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Foundation
                â”‚
           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚       PHASE 2: Core Infrastructure                â”‚
           â”‚                                                    â”‚
           â”‚  ğŸš¨ config (3000 lines)                           â”‚
           â”‚    â”œâ”€â†’ Phase 4: openai_model_info               â”‚
           â”‚    â”œâ”€â†’ Phase 4: codex_rmcp_client               â”‚
           â”‚    â”œâ”€â†’ Phase 4: codex_app_server_protocol       â”‚
           â”‚    â”œâ”€â†’ Phase 5: auth::AuthCredentialsStoreMode  â”‚
           â”‚    â”œâ”€â†’ Phase 3: git_info                        â”‚
           â”‚    â””â”€â†’ Phase 3: model_family                    â”‚
           â”‚                                                    â”‚
           â”‚  âœ“ config_loader (clean)                         â”‚
           â”‚  âœ“ message_history (clean)                       â”‚
           â”‚  âš  rollout::recorder (â†’ Phase 4: default_client)â”‚
           â”‚  âš  rollout::list (â†’ Phase 1: file_search)       â”‚
           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Provides config
                â”‚
           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚      PHASE 3: Execution & Tools Layer             â”‚
           â”‚                                                    â”‚
           â”‚  âš  exec (standalone crate)                       â”‚
           â”‚    â”œâ”€â†’ Phase 4: codex_ollama                     â”‚
           â”‚    â”œâ”€â†’ Phase 5: auth::enforce_login             â”‚
           â”‚    â”œâ”€â†’ Deferred: ConversationManager             â”‚
           â”‚    â””â”€â†’ Phase 2: config                           â”‚
           â”‚                                                    â”‚
           â”‚  âœ“ core/exec (sibling deps only)                 â”‚
           â”‚  âœ“ core/tools (2000+ lines, Phase 3 only)       â”‚
           â”‚  âœ“ core/sandboxing (Phase 3 only)               â”‚
           â”‚  âœ“ core/spawn                                   â”‚
           â”‚  âœ“ environment_context                           â”‚
           â”‚  âœ“ conversation_history                          â”‚
           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Provides execution
                â”‚
           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚    PHASE 4: Model Integration & MCP               â”‚
           â”‚                                                    â”‚
           â”‚  âš  core/client (1000+ lines)                     â”‚
           â”‚    â”œâ”€â†’ Phase 5: AuthManager                      â”‚
           â”‚    â”œâ”€â†’ Phase 5: codex_app_server_protocol        â”‚
           â”‚    â””â”€â†’ Phase 4: chat_completions                 â”‚
           â”‚                                                    â”‚
           â”‚  âœ“ core/chat_completions (Phase 4 only)         â”‚
           â”‚  âœ“ core/default_client                           â”‚
           â”‚  âœ“ core/client_common                            â”‚
           â”‚  âœ“ backend-client                                â”‚
           â”‚  âœ“ mcp-server                                    â”‚
           â”‚  âœ“ ollama (clean)                                â”‚
           â”‚  âœ“ core/mcp                                      â”‚
           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Provides model API
                â”‚
           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚      PHASE 5: Auth & CLI Polish                   â”‚
           â”‚                                                    â”‚
           â”‚  âœ“ core/auth (Phase 5 only)                      â”‚
           â”‚  ? login (OAuth - platform specific)              â”‚
           â”‚  ? keyring-store (OS keyring - platform specific)â”‚
           â”‚  âš  cli (may need selective porting)              â”‚
           â”‚  âš  app-server (HTTP server)                      â”‚
           â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Provides auth & CLI
                â”‚
           â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚    PHASE 6: Integration & Orchestration           â”‚
           â”‚                                                    â”‚
           â”‚  ğŸš¨ core/codex (3145 lines)                      â”‚
           â”‚    Requires ALL phases: P2, P3, P4, P5           â”‚
           â”‚    Cannot be ported until all complete            â”‚
           â”‚                                                    â”‚
           â”‚  ğŸš¨ core/codex_conversation                      â”‚
           â”‚    Depends on core/codex                          â”‚
           â”‚                                                    â”‚
           â”‚  ğŸš¨ core/conversation_manager                    â”‚
           â”‚    Depends on codex_conversation                  â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
MODULE DEPENDENCY MATRIX
================================================================================

Direction: â†’ = depends on

PHASE 2 DEPENDENCIES:

  core/config (3000)        â†’ P4: openai_model_info, rmcp_client, app_server_protocol
                            â†’ P5: auth
                            â†’ P3: git_info, model_family, model_provider_info
                            âš  CRITICAL: 6 forward dependencies
  
  config_loader (clean)      âœ“ No forward deps
  
  message_history (clean)    âœ“ No forward deps
  
  rollout/recorder           â†’ P4: default_client
                            â†’ P3: git_info
                            âš  WARNING: 2 forward dependencies
  
  rollout/list               â†’ P1: file_search
                            â†’ P3: protocol types
                            âš  WARNING: 1 forward dependency

PHASE 3 DEPENDENCIES:

  core/exec                  âœ“ No forward deps (Phase 3 only)
  
  core/tools (2000+)         âœ“ No forward deps (Phase 3 only)
  
  core/sandboxing            âœ“ No forward deps (Phase 3 only)
  
  exec (crate)               â†’ P4: codex_ollama
                            â†’ P5: auth enforcement
                            â†’ Deferred: ConversationManager
                            ğŸš¨ CRITICAL: 3 forward dependencies
  
  execpolicy (800)           âœ“ STANDALONE: Zero deps
  
  file-search (600)          âœ“ STANDALONE: Zero deps
  
  apply-patch (1600)         âœ“ STANDALONE: Zero deps

PHASE 4 DEPENDENCIES:

  core/client (1000+)        â†’ P5: AuthManager, CodexAuth
                            â†’ P5: codex_app_server_protocol
                            âš  WARNING: 3 forward dependencies
  
  core/chat_completions      âœ“ No forward deps
  
  core/default_client        âœ“ No forward deps
  
  backend-client             âœ“ No forward deps
  
  mcp-server                 âœ“ No forward deps
  
  ollama                      âœ“ No forward deps

PHASE 5 DEPENDENCIES:

  core/auth                  âœ“ No forward deps
  
  login                      âš  Platform-specific
  
  keyring-store              âš  Platform-specific
  
  cli                        âœ“ Mostly standalone

DEFERRED INTEGRATION:

  core/codex (3145)          ğŸš¨ REQUIRES ALL PHASES
                            Depends on P2, P3, P4, P5
                            CANNOT be ported before Phase 6
  
  core/codex_conversation    ğŸš¨ Depends on codex.rs
  
  core/conversation_manager  ğŸš¨ Depends on codex_conversation

================================================================================
CRITICAL PATH ANALYSIS
================================================================================

Most Blocking Modules (blocks others):

TIER 1 (Blocks everything):
  1. codex_protocol      - Required by ALL (~2,887 lines)
                         Action: Port/adapt first
  
  2. core/config         - ~3,000 lines, 14+ dependencies, central hub
                         Action: Refactor to DI, port with stubs
  
  3. core/codex          - 3,145 lines, requires ALL phases
                         Action: Defer to Phase 6

TIER 2 (Blocks Phase 4+):
  4. core/tools          - 2,000+ lines, coordination hub
                         Action: Port after Phase 2
  
  5. core/exec           - Execution engine
                         Action: Port after Phase 2, mock dependencies
  
  6. core/client         - Model client interface
                         Action: Port after Phase 3, mock auth

TIER 3 (Blocks specific modules):
  7. core/config_loader  - Blocks core/config completion
                         Action: Port immediately (clean)
  
  8. error types         - Used throughout
                         Action: Include in Phase 0

================================================================================
CROSS-PHASE FORWARD DEPENDENCIES (Anti-patterns)
================================================================================

PHASE 2 â†’ PHASE 3:
  core/config            â†’ git_info, model_family, model_provider_info
  rollout/recorder       â†’ git_info
  rollout/list           â†’ (implicit type usage)

PHASE 2 â†’ PHASE 4:
  core/config            â†’ openai_model_info, codex_rmcp_client, codex_app_server_protocol
  rollout/recorder       â†’ default_client

PHASE 2 â†’ PHASE 5:
  core/config            â†’ auth::AuthCredentialsStoreMode

PHASE 3 â†’ PHASE 4:
  exec                   â†’ codex_ollama

PHASE 3 â†’ PHASE 5:
  exec                   â†’ auth enforcement

PHASE 4 â†’ PHASE 5:
  core/client            â†’ AuthManager, CodexAuth, codex_app_server_protocol

DEFERRED â†’ MULTIPLE:
  core/codex             â†’ P2, P3, P4, P5 (all phases)

RECOMMENDED FIX: Dependency Injection Pattern
  - Interfaces instead of concrete imports
  - Stub implementations for Phase 2/3
  - Real implementations in Phase 4/5

================================================================================
RECOMMENDED PORT SEQUENCE
================================================================================

Week 1: PHASE 0 - Type Definitions & Framework
  - Port/define codex_protocol types
  - Create DI container
  - Define injectable interfaces for cross-phase concerns

Week 2: PHASE 1 - Standalone Modules (PARALLEL OK)
  - execpolicy (800 lines) âœ“ Zero deps
  - file-search (600 lines) âœ“ Zero deps
  - apply-patch (1600 lines) âœ“ Zero deps

Week 3: PHASE 2 - Infrastructure (WITH REFACTORING)
  - config_loader
  - message_history
  - rollout with adapters
  - config with DI

Week 4: PHASE 3 - Execution (PARALLEL WITH P4 OK)
  - core/exec
  - core/tools
  - core/sandboxing
  - Dependencies mocked

Week 5: PHASE 4 - Model Integration (PARALLEL WITH P5 OK)
  - client_common
  - chat_completions
  - backend-client
  - ollama

Week 6: PHASE 5 - Auth & CLI
  - core/auth
  - login (if porting)
  - cli

Week 7: PHASE 6 - Integration
  - core/codex
  - conversation_manager
  - Full integration tests

Critical Path: P0 â†’ P2 (refactored) â†’ P3 â†’ P4 â†’ P6
Total Estimated: 7 weeks (with refactoring, parallel work)

================================================================================
